{
  "$schema": "https://json-schema.org/draft-07/schema",
  "description": "Code coverage targets for Colibr√¨DB modules",
  "version": "1.0.0",
  "last_updated": "2025-10-18",
  "enforcement": {
    "mode": "strict",
    "block_pr_on_failure": true,
    "allow_temporary_exemption": false,
    "comment": "Coverage must meet targets before PR merge"
  },
  "global": {
    "minimum": 75,
    "target": 85,
    "excellent": 95,
    "description": "Default coverage for non-critical modules"
  },
  "modules": {
    "WAL": {
      "minimum": 95,
      "target": 98,
      "rationale": "Critical for durability and crash recovery",
      "files": [
        "Sources/ColibriCore/WAL/WALManager.swift",
        "Sources/ColibriCore/WAL/WALRecord.swift",
        "Sources/ColibriCore/WAL/WALTypes.swift"
      ]
    },
    "MVCC": {
      "minimum": 90,
      "target": 95,
      "rationale": "Critical for transaction correctness and isolation",
      "files": [
        "Sources/ColibriCore/MVCC/MVCCManager.swift",
        "Sources/ColibriCore/MVCC/MVCCTypes.swift"
      ]
    },
    "Transaction": {
      "minimum": 90,
      "target": 95,
      "rationale": "Critical for transaction management and concurrency",
      "files": [
        "Sources/ColibriCore/Transaction/TransactionManager.swift",
        "Sources/ColibriCore/Transaction/LockManager.swift"
      ]
    },
    "Indexes/BTree": {
      "minimum": 90,
      "target": 95,
      "rationale": "Critical index structure for performance",
      "files": [
        "Sources/ColibriCore/Indexes/BTreeIndex.swift",
        "Sources/ColibriCore/Indexes/BTreeIndexManager.swift"
      ]
    },
    "Storage/Pager": {
      "minimum": 85,
      "target": 90,
      "rationale": "Core storage abstraction layer",
      "files": [
        "Sources/ColibriCore/Storage/Pager/Pager.swift",
        "Sources/ColibriCore/Storage/Pager/Page.swift",
        "Sources/ColibriCore/Storage/Pager/PageCache.swift"
      ]
    },
    "BufferPool": {
      "minimum": 85,
      "target": 90,
      "rationale": "Memory management and caching",
      "files": [
        "Sources/ColibriCore/BufferPool/BufferPool.swift",
        "Sources/ColibriCore/BufferPool/BufferPoolManager.swift",
        "Sources/ColibriCore/Buffer/BufferManager.swift"
      ]
    },
    "Storage": {
      "minimum": 85,
      "target": 90,
      "rationale": "Primary storage for tuples",
      "files": [
        "Sources/ColibriCore/Storage/HeapTable.swift",
        "Sources/ColibriCore/Storage/HeapTableManager.swift",
        "Sources/ColibriCore/Storage/StorageManager.swift"
      ]
    },
    "Query": {
      "minimum": 80,
      "target": 85,
      "rationale": "Query processing and execution",
      "files": [
        "Sources/ColibriCore/Query/SQLParser.swift",
        "Sources/ColibriCore/Query/QueryExecutor.swift",
        "Sources/ColibriCore/Query/QueryOptimizer.swift"
      ]
    },
    "Catalog": {
      "minimum": 85,
      "target": 90,
      "rationale": "Metadata management",
      "files": [
        "Sources/ColibriCore/Catalog/Catalog.swift",
        "Sources/ColibriCore/Catalog/CatalogManager.swift"
      ]
    },
    "Indexes/FractalTree": {
      "minimum": 80,
      "target": 85,
      "rationale": "Advanced index structure",
      "files": [
        "Sources/ColibriCore/Indexes/FractalTreeIndex.swift"
      ]
    },
    "Util": {
      "minimum": 70,
      "target": 80,
      "rationale": "Utility functions, lower priority",
      "files": [
        "Sources/ColibriCore/Util/*.swift"
      ]
    }
  },
  "exclusions": {
    "files": [
      "Sources/*/main.swift",
      "Sources/benchmarks/*.swift",
      "Tests/**/*.swift"
    ],
    "patterns": [
      "**/Protocols.swift",
      "**/Types.swift"
    ],
    "rationale": "Entry points, benchmarks, and protocol definitions excluded"
  },
  "reporting": {
    "format": "lcov",
    "html_report": true,
    "fail_under_global": true,
    "fail_under_module": true,
    "show_missing_lines": true
  },
  "notes": [
    "Critical modules (WAL, MVCC, BTree, LockManager) require 90%+ coverage",
    "Core modules (Pager, BufferPool, Heap) require 85%+ coverage",
    "Query engine modules require 80%+ coverage",
    "Utilities and non-critical code require 70%+ coverage",
    "Update targets as codebase matures and tests improve",
    "New critical features must maintain 90%+ coverage from day one"
  ]
}

