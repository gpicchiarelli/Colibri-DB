SPECIFICATION Spec_ColibrìDB

CONSTANTS
  \* Core limits
  MAX_TX = 2
  MAX_LSN = 10
  MAX_PAGES = 3
  PAGE_SIZE = 4096
  
  \* Distributed
  Nodes = {n1, n2}
  CoordinatorNode = n1
  ReplicationFactor = 2
  
  \* Data
  Resources = {1, 2}
  Keys = {1, 2}
  Tables = {users, orders}
  Columns = {id, name, price}
  TxIds = {1, 2}
  
  \* Connection/Query
  ConnIds = {c1, c2, c3}
  QueryIds = {q1, q2}
  PreparedIds = {p1}
  IndexNames = {idx1, idx2}
  
  \* Pool & Memory
  POOL_SIZE = 2
  MIN_DEGREE = 2
  
  \* Thresholds
  VACUUM_THRESHOLD = 20
  STATS_THRESHOLD = 20
  MAX_CONNECTIONS = 10
  SESSION_TIMEOUT = 3600

INVARIANTS
  \* Master invariant (checks all subsystems)
  Inv_ColibrìDB_CompleteSafety
  
  \* Core invariants
  TypeOK_ColibrìDB
  Inv_ColibrìDB_ACID
  Inv_ColibrìDB_Serializability
  Inv_ColibrìDB_RecoveryIntegrity
  
  \* Bridge invariants
  Inv_ColibrìDB_DistributedConsistency
  Inv_ColibrìDB_Security
  Inv_ColibrìDB_QueryTypeSafety
  Inv_ColibrìDB_IndexConsistency
  Inv_ColibrìDB_ReferentialIntegrity
  Inv_ColibrìDB_ResourceManagement

PROPERTIES
  Prop_ColibrìDB_TxCompletion
  Prop_ColibrìDB_Recovery
  Prop_ColibrìDB_QueryCompletion

CONSTRAINT
  \* State space constraints for manageable verification
  Cardinality(activeTx) <= 2
  /\ nextLSN <= 10
  /\ globalTimestamp <= 20
  /\ Cardinality(aliveNodes) >= 1
  /\ Cardinality(DOMAIN activeSessions) <= 5
  /\ Len(auditLog) <= 20

\* Symmetry (helps reduce state space)
SYMMETRY Permutations(TxIds)
