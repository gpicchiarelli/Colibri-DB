<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - Colibr√¨DB</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <div class="container">
        <h1>üìö API Reference</h1>
        
        <h2>Database Core</h2>
        
        <h3>Colibr√¨DB</h3>
        <div class="api-section">
            <h4>Inizializzazione</h4>
            <div class="code-block">
                <pre><code>let config = Colibr√¨DBConfiguration(
    dataDirectory: URL,
    bufferPoolSize: Int = 1000,
    maxConnections: Int = 100,
    walBufferSize: Int = 1024 * 1024,
    checkpointInterval: TimeInterval = 300,
    logLevel: LogLevel = .info,
    enableStatistics: Bool = true,
    enableAutoAnalyze: Bool = true
)

let db = try Colibr√¨DB(config: config)</code></pre>
            </div>

            <h4>Lifecycle</h4>
            <div class="code-block">
                <pre><code>// Avvia il database
try await db.start()

// Verifica stato
let isRunning = await db.isDatabaseRunning()
let state = await db.getSystemState()

// Shutdown
try await db.shutdown()</code></pre>
            </div>
        </div>

        <h3>Transazioni</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>// Inizia transazione
let txID = try await db.beginTransaction()

// Commit
try await db.commit(txID: txID)

// Abort
try await db.abort(txID: txID)</code></pre>
            </div>
        </div>

        <h3>DDL Operations</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>// Crea tabella
let tableDef = TableDefinition(
    name: "users",
    columns: [
        ColumnDefinition(name: "id", type: .int, nullable: false),
        ColumnDefinition(name: "name", type: .string, nullable: false)
    ],
    primaryKey: ["id"]
)
try await db.createTable(tableDef)

// Elimina tabella
try await db.dropTable("users")</code></pre>
            </div>
        </div>

        <h3>DML Operations</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>// Insert
let row: Row = ["id": .int(1), "name": .string("Alice")]
let rid = try await db.insert(table: "users", row: row, txID: txID)

// Update
let updatedRow: Row = ["id": .int(1), "name": .string("Alice Updated")]
try await db.update(table: "users", rid: rid, row: updatedRow, txID: txID)

// Delete
try await db.delete(table: "users", rid: rid, txID: txID)

// Select
let result = try await db.select(table: "users", rid: rid, txID: txID)</code></pre>
            </div>
        </div>

        <h2>Tipi di Dati</h2>
        
        <h3>Row</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>let row: Row = [
    "id": .int(1),
    "name": .string("Alice"),
    "age": .int(25),
    "active": .bool(true),
    "data": .blob(Data())
]</code></pre>
            </div>
        </div>

        <h3>ColumnDefinition</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>let column = ColumnDefinition(
    name: "id",
    type: .int,
    nullable: false,
    defaultValue: .int(0)
)</code></pre>
            </div>
        </div>

        <h2>Configurazione</h2>
        
        <h3>LogLevel</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>enum LogLevel: String, CaseIterable {
    case trace = "TRACE"
    case debug = "DEBUG"
    case info = "INFO"
    case warning = "WARNING"
    case error = "ERROR"
    case fatal = "FATAL"
}</code></pre>
            </div>
        </div>

        <h2>Gestione Errori</h2>
        
        <h3>DBError</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>enum DBError: Error {
    case databaseNotRunning
    case transactionNotFound
    case schemaMismatch
    case constraintViolation
    case deadlockDetected
    case insufficientResources
    case invalidConfiguration
    case recoveryFailed
    case authenticationFailed
    case authorizationDenied
}</code></pre>
            </div>
        </div>

        <h2>Statistiche</h2>
        
        <h3>DatabaseStats</h3>
        <div class="api-section">
            <div class="code-block">
                <pre><code>let stats = await db.getStatistics()
print("Transactions: \(stats.transactionsStarted)")
print("Tables: \(stats.tablesCreated)")
print("Rows: \(stats.rowsInserted)")</code></pre>
            </div>
        </div>

        <h2>Prossimi Passi</h2>
        <ul>
            <li><a href="configuration.html">Configuration</a> - Configurazione avanzata</li>
            <li><a href="examples.html">Examples</a> - Esempi pratici</li>
            <li><a href="architecture.html">Architecture</a> - Architettura del sistema</li>
        </ul>
    </div>
</body>
</html>